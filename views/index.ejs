<!DOCTYPE html>
<html ng-app="upgradeManager" class="ng-cloak" >

<head>

    <base href="/">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Gateway Upgrade Manager: Login">
    <meta name="author" content="GUSHENXING">

    <title>Gateway Upgrade Manager</title>

    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="/css/theme/metisMenu.min.css" rel="stylesheet">

    <!-- Timeline CSS -->
    <link href="/css/theme/timeline.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/css/theme/sb-admin-2.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="/css/theme/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="/css/font-awesome/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/css/weather-icons-master/css/weather-icons.min.css" type="text/css">
    <link rel="stylesheet" href="/js/lib/angular-toggle-switch/angular-toggle-switch.css" type="text/css">
    <link rel="stylesheet" href="/js/lib/angular-chart.js/dist/angular-chart.css" />
    <link rel="stylesheet" href="/js/lib/angular-ui-grid/ui-grid.min.css" type="text/css">
    <link rel="stylesheet" href="/js/lib/angular-xeditable/dist/css/xeditable.css" type="text/css">
    <link rel="stylesheet" href="/js/lib/nvd3/build/nv.d3.min.css" type="text/css">
    <link rel="stylesheet" href="/css/app.css" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<script>username='<%=user.username%>';</script>
<body ng-controller="AppController as app">
<div id="wrapper">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top navbar-outer" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <a class="navbar-brand">Upgrade Manager</a>

        </div>
        <!-- /.navbar-header -->

        <ul class="nav navbar-top-links navbar-right">

            <li class="dropdown" uib-dropdown ng-show="theProject">

                <a class="dropdown-toggle" uib-dropdown-toggle id="map-switch" href>
                    <i class="fa fa-map fa-fw"></i>   <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-user" uib-dropdown-menu aria-labelledby="map-switch">
                    <li>
                        <a href="/">
                            <div>
                                <i class="fa fa-map-marker fa-fw"></i> {{'navigation.mapCountry' | translate }}
                            </div>
                        </a>
                    </li>
                </ul>

            </li>

            <li class="dropdown" ng-show="showUpgrade" >
                <a class="dropdown-toggle" ng-class="{'selected': isMenuActive('/upgrade')}" href="upgrade/{{theProject._id}}">
                    <i class="fa fa-cloud-download"></i> {{'navigation.upgrade' | translate }}
                </a>

            </li>

            <!-- /.dropdown -->
            <li class="dropdown" uib-dropdown>

                <a class="dropdown-toggle" uib-dropdown-toggle id="user-drowdown" href>
                    <%= user.name?user.name:user.username %>  <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-user" uib-dropdown-menu aria-labelledby="user-drowdown">

                    <li>
                        <a href="#" ng-click="openUserProfileModal();"><i class="fa fa-user fa-fw"></i> {{'navigation.userSetting' | translate }}</a>
                    </li>
                    <% if (user.role == 'admin') { %>
                    <li>
                        <a href="#" ng-click="openUserManagementModal();"><i class="fa fa-users fa-fw"></i> {{'navigation.userManagement' | translate }}</a>
                    </li>
                    <li>
                        <a href="#" ng-click="openCreateUserModal();"><i class="fa fa-user-plus fa-fw"></i> {{'navigation.createUser' | translate }}</a>
                    </li>
                    <% } %>

                    <li class="divider"></li>
                    <li>
                        <a href="/logout" target="_self"><i class="fa fa-sign-out fa-fw"></i> {{'navigation.logout' | translate }}</a>
                    </li>
                </ul>

            </li>

        </ul>

        <!-- /.navbar-static-side -->
    </nav> <!-- end site-wise top nav -->


    <div id="page-wrapper" ui-view>


    </div>
    <!-- /#page-wrapper -->

</div>
<!-- /#wrapper -->


<script src="/js/lib/jquery/dist/jquery.min.js"></script>

<script src="/js/lib/angular/angular.min.js"></script>
<script src="/js/lib/angular-ui-router/release/angular-ui-router.min.js"></script>
<script src="/js/lib/angular-route/angular-route.min.js"></script>
<script src="/js/lib/angular-locale/angular-locale_zh-cn.js"></script>
<script src="/js/lib/angular-bootstrap/ui-bootstrap.min.js"></script>
<script src="/js/lib/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>
<script src="/js/lib/angular-ui-utils/event.min.js"></script>
<script src="/js/lib/angular-ui-map-baidu/ui-map.js"></script>
<script src="/js/lib/angular-translate/angular-translate.min.js"></script>
<script src="/js/lib/checklist-model/checklist-model.js"></script>
<script src="/js/lib/angular-xeditable/dist/js/xeditable.min.js"></script>
<script src="/js/lib/d3/d3.js"></script>
<script src="/js/lib/nvd3/build/nv.d3.js"></script> <!-- or use another assembly -->
<script src="/js/lib/angular-nvd3/dist/angular-nvd3.js"></script>
<script src="/js/lib/ngRadialGauge/src/ng-radial-gauge-dir.js"></script>
<script src="/js/lib/angular-ui-grid/ui-grid.js"></script>
<script src="/js/lib/angular-toggle-switch/angular-toggle-switch.js"></script>
<script src="/js/lib/angular-local-storage/dist/angular-local-storage.js"></script>

<script src="/js/lib/bootstrap-ui-datetime-picker/dist/datetime-picker.min.js"></script>
<script src="/js/lib/angular-bootstrap-show-errors/src/showErrors.min.js"></script>
<script src="/js/lib/Chart.js/Chart.min.js"></script>
<script src="/js/lib/angular-chart.js/dist/angular-chart.min.js"></script>
<script src="/js/lib/ng-remote-validate/release/ngRemoteValidate.js"></script>
<script src="/js/lib/pdfmake/build/pdfmake.js"></script>
<script src="/js/lib/pdfmake/build/vfs_fonts.js"></script>

<script src="/js/app.js"></script>
<script src="/js/controllers.js"></script>
<script src="/js/directives.js"></script>
<script src="/js/services.js"></script>
<script src="/socket.io/socket.io.js"></script>
</body>

</html>


<script type="text/ng-template" id="CreateUserModal.html">
    <div class="modal-header">
        <h3 class="modal-title">{{'navigation.createUser' | translate }}</h3>
    </div>

    <div class="modal-body">
        <div class="panel panel-default panel-no-border">
            <div class="panel-body">
                <form name="createUserForm" role="form">
                    <div class="form-group" show-errors>
                        <label>{{'user.username' | translate }}</label>
                        <input name="username"
                               type="email"
                               ng-required="true"
                               onbeforesave="validateUsername($data)"
                               ng-model="newUser.username"
                               ng-remote-validate="/api/validate/username"
                               class="form-control"
                               placeholder="{{'user.usernamePrompt' | translate }}" />

                        <span class="input-error" ng-show="createUserForm.username.$error.email">
                            {{'validation.USERNAME_INVALID' | translate}}</span>
                        <span class="input-error" ng-show="createUserForm.username.$error.ngRemoteValidate">
                            {{'validation.USERNAME_DUPLICATE' | translate}}</span>
                    </div>

                    <div class="form-group" show-errors>
                        <label>{{'user.password' | translate }}</label>
                        <input name="password"
                               id="password"
                               type="password"
                               class="form-control"
                               ng-model="newUser.password"
                               ng-pattern="/^(?=.*\d)(?=.*[a-zA-Z])([a-zA-Z0-9]){8,}$/"
                               placeholder="{{'user.passwordPrompt' | translate }}"/>
                        <span class="input-error" ng-show="createUserForm.password.$error.pattern">{{'validation.PASSWORD_INVALID' | translate}}</span>
                    </div>

                    <div class="form-group" show-errors>
                        <label>{{'user.confirmPassword' | translate }}</label>
                        <input class="form-control"
                               type="password"
                               name="confirmPassword"
                               ng-model="newUser.confirmPassword"
                               required
                               compare-to="password" />
                        <span class="input-error" ng-show="createUserForm.confirmPassword.$error.compareto">{{'validation.PASSWORD_NOTMATCH' | translate}}</span>
                    </div>

                    <div class="form-group" show-errors>
                        <label>{{'user.role' | translate }}</label>
                        <select class="form-control"
                                name="role"
                                ng-model="newUser.role">
                            <option ng-repeat="ro in roleOptions" value="{{ro}}">{{'user.' + ro | translate }}</option>
                        </select>
                    </div>

                    <div class="input-error" ng-show="err">{{'validation.CREATE_USER_FAIL' | translate}}</div>
                    <div class="input-info" ng-show="created.username">{{'validation.CREATE_USER_SUCCESS' | translate}}: {{created.username}}</div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button class="btn btn-primary" ng-disabled="!createUserForm.$valid" type="button" ng-click="ok()">{{'label.confirm' | translate }}</button>
        <button class="btn btn-warning" type="button" ng-click="cancel()">{{'label.cancel' | translate }}</button>
    </div>

</script>



<script type="text/ng-template" id="UserProfileModal.html">
    <div class="modal-header">
        <h3 class="modal-title">{{'navigation.userProfile' | translate }}</h3>
    </div>

    <div class="modal-body">
        <div class="panel panel-default panel-no-border">
            <div class="panel-body">
                <form name="userProfileForm" role="form">
                    <div class="form-group" show-errors>
                        <label>{{'user.name' | translate }}</label>
                        <input name="name"
                               type="text"
                               ng-model="user.name"
                               class="form-control"
                               placeholder="{{'user.namePrompt' | translate }}" />
                    </div>

                    <div class="form-group" show-errors>
                        <label>{{'user.newPassword' | translate }}</label>
                        <input name="password"
                               type="password"
                               id="password1"
                               class="form-control"
                               ng-pattern="/^((?=.*\d)(?=.*[a-zA-Z])([a-zA-Z0-9]){8,})?$/"
                               ng-model="user.password"
                               placeholder="{{'user.passwordPrompt' | translate }}"/>
                        <span class="input-error" ng-show="userProfileForm.password.$error.pattern">{{'validation.PASSWORD_INVALID' | translate}}</span>
                    </div>

                    <div class="form-group" show-errors>
                        <label>{{'user.confirmNewPassword' | translate }}</label>
                        <input class="form-control"
                               type="password"
                               name="confirmPassword"
                               ng-model="user.confirmPassword"
                               compare-to="password1" />
                        <span class="input-error" ng-show="userProfileForm.confirmPassword.$error.compareto">{{'validation.PASSWORD_NOTMATCH' | translate}}</span>
                    </div>
                    <div class="input-error" ng-show="err">{{'validation.UPDATE_USER_FAIL' | translate}}</div>
                    <div class="input-info" ng-show="updated">{{'validation.UPDATE_USER_SUCCESS' | translate}}</div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-disabled="!userProfileForm.$valid" type="button" ng-click="ok()">{{'label.confirm' | translate }}</button>
        <button class="btn btn-warning" type="button" ng-click="cancel()">{{'label.cancel' | translate }}</button>
    </div>

</script>



<script type="text/ng-template" id="UserManagementModal.html">
    <div class="modal-header">
        <h3 class="modal-title">{{'navigation.userManagement' | translate }}</h3>
    </div>

    <div class="modal-body">
        <div class="panel panel-default panel-no-border">
            <div class="panel-body">
                <form name="userManagementForm" role="form">
                    <div class="row" ng-repeat="user in users">
                        <div class="col-lg-6">
                            <div class="form-group">
                                <div class="form-group">
                                    <h5>{{user.username}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group" show-errors>
                                <select class="form-control"
                                        name="role"
                                        ng-model="user.role">
                                    <option ng-repeat="ro in roleOptions" value="{{ro}}">{{'user.' + ro | translate }}</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="input-error" ng-show="err">{{'validation.UPDATE_USERS_FAIL' | translate}}</div>
                    <div class="input-info" ng-show="updated">{{'validation.UPDATE_USERS_SUCCESS' | translate}}</div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-disabled="!userManagementForm.$valid" type="button" ng-click="ok()">{{'label.confirm' | translate }}</button>
        <button class="btn btn-warning" type="button" ng-click="cancel()">{{'label.cancel' | translate }}</button>
    </div>

</script>





<script type="text/ng-template" id="ControlModal.html">
    <div class="modal-header">
        <h3 class="modal-title">{{'monitor.control' | translate }}:{{sensor.name}}</h3>
    </div>
    <div class="modal-body">
        <div class="panel panel-default panel-no-border">
            <div class="panel-body">
                <div class="form-group">
                    <label>{{'sensor.diovalue' | translate}}</label>

                    <div class="radio">
                        <label>
                            <input type="radio" ng-model="value" value="0">{{'sensor.off' | translate}}
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input type="radio" ng-model="value" value="1">{{'sensor.on' | translate}}
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" type="button" ng-click="ok()">{{'label.confirm' | translate }}</button>
        <button class="btn btn-warning" type="button" ng-click="cancel()">{{'label.cancel' | translate }}</button>
    </div>
</script>



<script type="text/ng-template" id="RefreshModal.html">
    <div class="modal-header">
        <h3 class="modal-title">{{'monitor.manualRefresh' | translate }}:{{name}}</h3>
    </div>
    <div class="modal-body">
        <div class="panel panel-default panel-no-border">
            <div class="panel-body">
                {{'msg.manualRefreshPrompt' | translate }}
                <br/>
                {{name}}
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" type="button" ng-click="ok()">{{'label.confirm' | translate }}</button>
        <button class="btn btn-warning" type="button" ng-click="cancel()">{{'label.cancel' | translate }}</button>
    </div>
</script>


<script type="text/ng-template" id="ScheduledDowntimeModal.html">
    <div class="modal-header">
        <h3 class="modal-title">{{'monitor.downtime' | translate }}:{{name}}</h3>
    </div>

    <div class="modal-body">
        <div class="panel panel-default panel-no-border">
            <div class="panel-body">
                <form name="downtimeForm" role="form">
                    <div class="form-group" show-errors>
                        <label>{{'label.downtimeStart' | translate }}</label>
                        <p class="input-group">
                            <input type="text" class="form-control"
                                   datetime-picker="yyyy-MM-dd HH:mm"
                                   ng-model="sd.start" is-open="isStartOpen"
                                   name="sdstart"
                                   ng-required="true"
                                   date-text="{{'label.date' | translate }}"
                                   time-text="{{'label.time' | translate }}"
                                   today-text="{{'label.today' | translate }}"
                                   close-text="{{'label.close' | translate }}"
                                   now-text="{{'label.now' | translate }}"
                                   clear-text="{{'label.reset' | translate }}"
                                   placeholder="{{'label.downtimeStart' | translate }}"/>
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-click="openStartCalendar($event, prop)"><i class="fa fa-calendar"></i></button>
                                </span>
                        </p>
                    </div>


                    <div class="form-group" show-errors>
                        <label>{{'label.downtimeEnd' | translate }}</label>
                        <p class="input-group">
                            <input type="text" class="form-control"
                                   datetime-picker="yyyy-MM-dd HH:mm"
                                   ng-model="sd.end"
                                   name="sdend"
                                   ng-required="true"
                                   is-open="isEndOpen"
                                   date-text="{{'label.date' | translate }}"
                                   time-text="{{'label.time' | translate }}"
                                   today-text="{{'label.today' | translate }}"
                                   now-text="{{'label.now' | translate }}"
                                   clear-text="{{'label.reset' | translate }}"
                                   close-text="{{'label.close' | translate }}"
                                   placeholder="{{'label.downtimeEnd' | translate }}"/>
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="openEndCalendar($event, prop)"><i class="fa fa-calendar"></i></button>
                            </span>
                        </p>

                    </div>

                    <div class="form-group" show-errors>
                        <label>{{'label.notes' | translate }}</label>
                    <textarea class="form-control" name="sdnotes" ng-required="true"
                              ng-model="sd.notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <div class="modal-footer">
        <button class="btn btn-primary" ng-disabled="!downtimeForm.$valid" type="button" ng-click="ok()">{{'label.confirm' | translate }}</button>
        <button class="btn btn-warning" type="button" ng-click="cancel()">{{'label.cancel' | translate }}</button>
    </div>

</script>


<script type="text/ng-template" id="SoftwareUpgradeModal.html">
    <div class="modal-header">
        <h3 class="modal-title">{{'label.softwareUpgrade' | translate }}</h3>
    </div>
    <div class="modal-body">
        <div class="panel panel-default panel-no-border">
            <div class="panel-body">
                Do you want to upgrade Gateway-{{gateway.gatewayId}} : {{gateway.name}} with software version {{gateway.newVersion}} ?

            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" type="button" ng-click="ok()">{{'label.confirm' | translate }}</button>
        <button class="btn btn-warning" type="button" ng-click="cancel()">{{'label.cancel' | translate }}</button>
    </div>
</script>
